/**
 * jQuery Plugin for fetching row from database
 * @version 1.3
 * @requires jQuery 1.4 or later
 *
 * Copyright (c) 2016 Lucky
 * Licensed under the GPL license:
 *   http://www.gnu.org/licenses/gpl.html
 */

(function(b){function a(g,f){var h=this;var e=(g.keyfield===null)?f:g.keyfield;var d="";this.preventEnter=function(){f.keypress(function(i){if(i.keyCode===13){return false}return true})};this.doRequest=function(){if(e.val()!==""){d="";if(typeof g.additionalFields==="object"){for(var i in g.additionalFields){d=d+i+encodeURI(g.additionalFields[i].val())}}b.ajax({url:g.url+encodeURI(e.val())+d,beforeSend:function(){if(typeof g.onRequest==="function"){g.onRequest.call()}},complete:function(){if(typeof g.onComplete==="function"){g.onComplete.call()}},success:function(j){try{var k=null;if(typeof j==="string"){k=b.parseJSON(j)}else{if(typeof j==="object"){k=j}}if(typeof g.onPopulated==="function"){if(k==null){if(typeof g.onNullPopulated==="function"){g.onNullPopulated.call(this,f)}}else{g.onPopulated.call(this,k,f)}}}catch(l){if(typeof g.onError==="function"){g.onError.call()}}},error:function(l,j,k){if(typeof g.onError==="function"){g.onError.call()}}})}else{g.onNullPopulated.call(this,f)}};var c=g.trigger.split("|");switch(c[0]){case"keypress":f.keyup(function(i){if(i.keyCode===parseInt(c[1])){h.doRequest()}});f.attr("autocomplete","off");this.preventEnter();break;case"blur":f.blur(function(i){h.doRequest()});break;case"change":f.change(function(i){h.doRequest()});break;case"click":f.click(function(i){h.doRequest()});break}}b.fn.fetchrow=function(c){var d={onRequest:null,onComplete:null,onPopulated:null,onNullPopulated:null,onError:function(){alert("Sorry, an error has occured!")},trigger:"keypress|13",keyfield:null,additionalFields:[]};b.extend(d,c);return this.each(function(){var e=new a(d,b(this))})}})(jQuery);
