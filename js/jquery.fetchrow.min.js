/**
 * jQuery Plugin for fetching row from database
 * @requires jQuery 1.4 or later
 *
 * Copyright (c) 2016 Lucky
 * Licensed under the GPL license:
 *   http://www.gnu.org/licenses/gpl.html
 */

(function(b){function a(d,f){var l=this;var j=(d.keyfield===null)?f:d.keyfield;var h=(d.button===null)?f:d.button;var c="";this.preventEnter=function(){f.keypress(function(i){if(i.keyCode===13){return false}return true})};this.doRequest=function(){if(j.val()!==""){c="";if(typeof d.additionalFields==="object"){for(var i in d.additionalFields){c=c+i+encodeURI(d.additionalFields[i].val())}}b.ajax({url:d.url+encodeURI(j.val())+c,beforeSend:function(){if(typeof d.onRequest==="function"){d.onRequest.call()}},complete:function(){if(typeof d.onComplete==="function"){d.onComplete.call()}},success:function(n){try{var o=null;if(typeof n==="string"){o=b.parseJSON(n)}else{if(typeof n==="object"){o=n}}if(typeof d.onPopulated==="function"){if(o==null){if(typeof d.onNullPopulated==="function"){d.onNullPopulated.call(this,f)}}else{d.onPopulated.call(this,o,f)}}}catch(p){if(typeof d.onError==="function"){d.onError.call()}}},error:function(p,n,o){if(typeof d.onError==="function"){d.onError.call()}}})}else{d.onNullPopulated.call(this,f)}};var k=f;var m=d.trigger.split(",");for(var e=0;e<m.length;e++){var g=m[e].split("|");if(b.inArray(g[0],["keypress","blur","change"])>-1){k=j}else{k=h}switch(g[0]){case"keypress":k.keyup(function(i){if(i.keyCode===parseInt(g[1])){l.doRequest()}});k.attr("autocomplete","off");this.preventEnter();break;case"blur":k.blur(function(i){l.doRequest()});break;case"change":k.change(function(i){l.doRequest()});break;case"click":k.click(function(i){l.doRequest()});break}}}b.fn.fetchrow=function(c){var d={onRequest:null,onComplete:null,onPopulated:null,onNullPopulated:null,onError:function(){alert("Sorry, an error has occured!")},trigger:"keypress|13",keyfield:null,button:null,additionalFields:[]};b.extend(d,c);return this.each(function(){var e=new a(d,b(this))})}})(jQuery);
